# Manual de Uso - PQ Trader

## Tabla de Contenidos

1. [Introducción](#introducción)
2. [Para Usuarios (Estudiantes)](#para-usuarios-estudiantes)
3. [Para Administradores](#para-administradores)
4. [Solución de Problemas](#solución-de-problemas)

---

## Introducción

PQ Trader es una plataforma de educación en trading algorítmico que ofrece cursos, mentorías personalizadas y recursos educativos para traders que desean aprender análisis cuantitativo y desarrollo de estrategias automatizadas.

### Características Principales

- ✅ **Cursos en línea** con lecciones estructuradas
- ✅ **Mentorías 1-a-1** con traders profesionales
- ✅ **Blog educativo** con artículos sobre trading
- ✅ **Track Records** de estrategias reales
- ✅ **Integración con Darwinex** para datos de mercado
- ✅ **Pagos seguros** con Stripe y PayPal
- ✅ **Dashboard personalizado** para seguimiento de progreso

---

## Para Usuarios (Estudiantes)

### 1. Registro e Inicio de Sesión

#### Crear una Cuenta

1. Visita [https://pqtraders.com](https://pqtraders.com)
2. Haz clic en **"Registrarse"** en la esquina superior derecha
3. Completa el formulario con:
   - Nombre completo
   - Correo electrónico
   - Contraseña (mínimo 8 caracteres)
4. Haz clic en **"Crear Cuenta"**
5. Recibirás un email de confirmación

#### Iniciar Sesión

1. Haz clic en **"Iniciar Sesión"**
2. Ingresa tu correo electrónico y contraseña
3. Haz clic en **"Entrar"**

> **Nota:** Tu sesión permanecerá activa durante 30 días. Si olvidas tu contraseña, usa la opción "Recuperar contraseña".

---

### 2. Explorar y Comprar Cursos

#### Navegar por los Cursos

1. Haz clic en **"Cursos"** en el menú principal
2. Explora los cursos disponibles con:
   - Descripción del curso
   - Número de lecciones
   - Precio
   - Nivel de dificultad
3. Haz clic en un curso para ver más detalles

#### Comprar un Curso

**Con Stripe (Tarjeta de Crédito/Débito):**

1. En la página del curso, haz clic en **"Comprar Curso"**
2. Selecciona **"Pagar con Stripe"**
3. Ingresa los datos de tu tarjeta:
   - Número de tarjeta
   - Fecha de expiración
   - CVC
   - Código postal
4. Haz clic en **"Pagar ahora"**
5. Espera la confirmación del pago

**Con PayPal:**

1. En la página del curso, haz clic en **"Comprar Curso"**
2. Selecciona **"Pagar con PayPal"**
3. Serás redirigido a PayPal
4. Inicia sesión en tu cuenta PayPal
5. Confirma el pago
6. Serás redirigido de vuelta a PQ Trader

> **Nota:** Los pagos son procesados de forma segura. PQ Trader no almacena información de tarjetas de crédito.

#### Acceder al Contenido del Curso

1. Después de la compra, ve a **"Mi Dashboard"**
2. En la sección **"Mis Cursos"**, verás todos tus cursos activos
3. Haz clic en un curso para acceder a las lecciones
4. Las lecciones se desbloquean de forma secuencial
5. Haz clic en una lección para ver:
   - Contenido escrito
   - Videos educativos
   - Recursos descargables
   - Ejercicios prácticos

---

### 3. Mentorías Personalizadas

#### Explorar Mentorías Disponibles

1. Haz clic en **"Mentorías"** en el menú principal
2. Revisa las opciones de mentoría:
   - **Sesión Individual:** 1 hora con un mentor
   - **Paquete 3 Sesiones:** 3 sesiones + seguimiento
   - **Paquete 5 Sesiones:** 5 sesiones + proyecto final
   - **Mentoría Mensual:** Sesiones ilimitadas durante 30 días

#### Reservar una Mentoría

1. Selecciona el paquete de mentoría deseado
2. Haz clic en **"Reservar Mentoría"**
3. Completa el pago (Stripe o PayPal)
4. Recibirás un email con instrucciones
5. El equipo de PQ Trader te contactará para agendar tu primera sesión

#### Durante la Mentoría

- Las sesiones se realizan por **videollamada** (Zoom/Google Meet)
- Duración: **1 hora por sesión**
- Puedes compartir pantalla para revisar código o estrategias
- El mentor te enviará material adicional después de la sesión
- Tienes acceso a soporte por email entre sesiones

---

### 4. Blog y Recursos Educativos

#### Leer Artículos del Blog

1. Haz clic en **"Blog"** en el menú principal
2. Explora artículos sobre:
   - Introducción al trading algorítmico
   - Python vs R en finanzas cuantitativas
   - Machine Learning aplicado al trading
   - Análisis técnico y fundamental
3. Haz clic en un artículo para leerlo completo
4. Comparte en redes sociales si te resulta útil

#### Artículos Destacados

- Los artículos más recientes aparecen primero
- Usa la barra lateral para ver artículos relacionados
- Activa las notificaciones para recibir nuevos artículos

---

### 5. Contacto y Soporte

#### Formulario de Contacto

1. Haz clic en **"Contacto"** en el menú principal
2. Completa el formulario con:
   - Tu nombre
   - Correo electrónico
   - Mensaje detallado
3. Haz clic en **"Enviar Mensaje"**
4. Recibirás respuesta en **24-48 horas**

> **Límite de envío:** Máximo 3 mensajes por hora para prevenir spam.

#### Canales de Soporte

- **Email:** info@pqtraders.com
- **Horario de atención:** Lunes a Viernes, 9:00 AM - 6:00 PM (GMT-5)
- **Tiempo de respuesta:** 24-48 horas hábiles

---

### 6. Mi Dashboard

#### Acceder al Dashboard

1. Inicia sesión en tu cuenta
2. Haz clic en tu nombre en la esquina superior derecha
3. Selecciona **"Mi Dashboard"**

#### Secciones del Dashboard

**Resumen General:**
- Cursos activos
- Próximas sesiones de mentoría
- Progreso de aprendizaje
- Certificados obtenidos

**Mis Cursos:**
- Lista de cursos comprados
- Porcentaje de completitud
- Última lección vista
- Acceso rápido a lecciones

**Mis Mentorías:**
- Sesiones disponibles
- Historial de sesiones completadas
- Próximas citas agendadas
- Notas del mentor

**Historial de Pagos:**
- Transacciones realizadas
- Facturas descargables
- Estado de pagos
- Método de pago utilizado

---

## Para Administradores

### 1. Acceso al Panel de Administración

#### Iniciar Sesión como Admin

1. Visita [https://pqtraders.com/login](https://pqtraders.com/login)
2. Ingresa tus credenciales de administrador
3. Serás redirigido al **Dashboard de Admin**

> **Nota:** Solo usuarios con rol `admin` pueden acceder al panel de administración.

---

### 2. Gestión de Cursos

#### Crear un Nuevo Curso

**Endpoint:** `POST /api/courses`

**Desde el Dashboard:**

1. Ve a **"Cursos"** → **"Crear Nuevo"**
2. Completa el formulario:
   - **Título (ES):** Nombre del curso en español
   - **Título (EN):** Nombre del curso en inglés
   - **Descripción (ES):** Descripción detallada en español
   - **Descripción (EN):** Descripción detallada en inglés
   - **Precio:** En dólares (ejemplo: 99.99)
   - **Nivel:** Principiante, Intermedio o Avanzado
   - **Duración:** En horas
   - **Imagen:** URL de la imagen del curso
   - **Estado:** Borrador o Publicado
3. Haz clic en **"Crear Curso"**

**Usando cURL (API):**

```bash
curl -X POST https://api.pqtraders.com/api/courses \
  -H "Authorization: Bearer <TOKEN_ADMIN>" \
  -H "Content-Type: application/json" \
  -d '{
    "title_es": "Trading Algorítmico con Python",
    "title_en": "Algorithmic Trading with Python",
    "description_es": "Aprende a crear estrategias automatizadas",
    "description_en": "Learn to create automated strategies",
    "price": 199.99,
    "level": "intermediate",
    "duration": 40,
    "image_url": "https://example.com/image.jpg",
    "status": "published"
  }'
```

#### Editar un Curso Existente

**Endpoint:** `PUT /api/courses/:id`

1. Ve a **"Cursos"** → Selecciona el curso
2. Haz clic en **"Editar"**
3. Modifica los campos necesarios
4. Haz clic en **"Guardar Cambios"**

#### Eliminar un Curso

**Endpoint:** `DELETE /api/courses/:id`

1. Ve a **"Cursos"** → Selecciona el curso
2. Haz clic en **"Eliminar"**
3. Confirma la acción

> **Advertencia:** Eliminar un curso NO elimina las inscripciones existentes, pero los usuarios no podrán acceder al contenido.

---

### 3. Gestión de Lecciones

#### Crear una Lección

**Endpoint:** `POST /api/lessons`

1. Ve al curso → **"Lecciones"** → **"Crear Nueva"**
2. Completa el formulario:
   - **Título (ES/EN):** Nombre de la lección
   - **Contenido (ES/EN):** Contenido en formato Markdown
   - **Video URL:** URL del video (YouTube, Vimeo, etc.)
   - **Orden:** Posición en el curso (1, 2, 3...)
   - **Duración:** Tiempo estimado en minutos
   - **Tipo:** video, text, quiz, assignment
   - **Estado:** Borrador o Publicado
3. **Subir Recursos:**
   - PDF, archivos de código, datasets
   - Se suben a Supabase Storage automáticamente

**Usando cURL (API):**

```bash
curl -X POST https://api.pqtraders.com/api/lessons \
  -H "Authorization: Bearer <TOKEN_ADMIN>" \
  -H "Content-Type: application/json" \
  -d '{
    "course_id": "uuid-del-curso",
    "title_es": "Introducción a Pandas",
    "title_en": "Introduction to Pandas",
    "content_es": "# Pandas\n\nPandas es...",
    "content_en": "# Pandas\n\nPandas is...",
    "video_url": "https://youtube.com/watch?v=xxx",
    "order_index": 1,
    "duration": 25,
    "type": "video",
    "status": "published"
  }'
```

#### Subir Archivos a una Lección

**Endpoint:** `POST /api/lessons/:id/upload`

**Desde el Dashboard:**

1. Edita la lección
2. En la sección **"Recursos"**, haz clic en **"Subir archivo"**
3. Selecciona el archivo (máx. 50MB)
4. El archivo se subirá a Supabase Storage
5. La URL se guardará automáticamente

**Usando cURL (API):**

```bash
curl -X POST https://api.pqtraders.com/api/lessons/uuid/upload \
  -H "Authorization: Bearer <TOKEN_ADMIN>" \
  -F "file=@archivo.pdf"
```

**Archivos permitidos:**
- PDF, DOCX, XLSX
- Código: .py, .r, .ipynb
- Datasets: .csv, .json
- Imágenes: .jpg, .png
- Máximo: 50MB por archivo

---

### 4. Gestión de Usuarios

#### Ver Todos los Usuarios

**Endpoint:** `GET /api/users`

1. Ve a **"Usuarios"** en el panel admin
2. Verás la lista completa con:
   - Nombre
   - Email
   - Rol (student, admin)
   - Fecha de registro
   - Cursos inscritos

#### Cambiar Rol de Usuario

**Endpoint:** `PUT /api/users/:id/role`

**Desde el Dashboard:**

1. Selecciona un usuario
2. Haz clic en **"Cambiar Rol"**
3. Selecciona: `student` o `admin`
4. Confirma el cambio

**Usando cURL (API):**

```bash
curl -X PUT https://api.pqtraders.com/api/users/uuid/role \
  -H "Authorization: Bearer <TOKEN_ADMIN>" \
  -H "Content-Type: application/json" \
  -d '{"role": "admin"}'
```

#### Ver Inscripciones de un Usuario

1. Selecciona un usuario
2. Ve a la pestaña **"Inscripciones"**
3. Verás:
   - Cursos comprados
   - Fecha de compra
   - Progreso
   - Monto pagado

---

### 5. Gestión del Blog

#### Crear un Artículo

**Endpoint:** `POST /api/blog`

**Desde el Dashboard:**

1. Ve a **"Blog"** → **"Crear Artículo"**
2. Completa el formulario:
   - **Título (ES/EN)**
   - **Slug:** URL amigable (auto-generado)
   - **Contenido (ES/EN):** Markdown con HTML
   - **Extracto (ES/EN):** Resumen corto
   - **Imagen destacada:** URL
   - **Meta descripción:** Para SEO
   - **Categorías:** Trading, Python, Análisis, etc.
   - **Estado:** Borrador, Publicado o Archivado
   - **Destacado:** Aparecerá en homepage
3. Haz clic en **"Publicar"**

**Usando cURL (API):**

```bash
curl -X POST https://api.pqtraders.com/api/blog \
  -H "Authorization: Bearer <TOKEN_ADMIN>" \
  -H "Content-Type: application/json" \
  -d '{
    "title_es": "Introducción al Trading Algorítmico",
    "title_en": "Introduction to Algorithmic Trading",
    "slug": "introduccion-trading-algoritmico",
    "content_es": "<h2>¿Qué es el trading algorítmico?</h2>...",
    "content_en": "<h2>What is algorithmic trading?</h2>...",
    "excerpt_es": "Descubre cómo automatizar tus estrategias",
    "excerpt_en": "Discover how to automate your strategies",
    "featured_image": "https://example.com/image.jpg",
    "meta_description_es": "Guía completa sobre trading algorítmico",
    "meta_description_en": "Complete guide to algorithmic trading",
    "categories": ["Trading", "Principiantes"],
    "status": "published",
    "featured": true
  }'
```

#### Editar un Artículo

**Endpoint:** `PUT /api/blog/:id`

1. Ve a **"Blog"** → Selecciona el artículo
2. Haz clic en **"Editar"**
3. Modifica los campos
4. Haz clic en **"Actualizar"**

#### Eliminar un Artículo

**Endpoint:** `DELETE /api/blog/:id`

1. Selecciona el artículo
2. Haz clic en **"Eliminar"**
3. Confirma la acción

> **Nota:** Los artículos eliminados no se pueden recuperar.

---

### 6. Gestión de Pagos y Transacciones

#### Ver Todas las Transacciones

**Endpoint:** `GET /api/transactions`

1. Ve a **"Finanzas"** → **"Transacciones"**
2. Verás:
   - Usuario
   - Producto (curso/mentoría)
   - Monto
   - Método de pago (Stripe/PayPal)
   - Estado (pending, completed, failed, refunded)
   - Fecha

#### Filtrar Transacciones

**Por Estado:**

```bash
GET /api/transactions?status=completed
```

**Por Método de Pago:**

```bash
GET /api/transactions?payment_method=stripe
```

**Por Fecha:**

```bash
GET /api/transactions?start_date=2026-01-01&end_date=2026-01-31
```

#### Procesar Reembolso

**Endpoint:** `POST /api/transactions/:id/refund`

**Desde Stripe Dashboard:**

1. Ve a [dashboard.stripe.com](https://dashboard.stripe.com)
2. Busca la transacción
3. Haz clic en **"Refund"**
4. El sistema actualizará automáticamente el estado en PQ Trader

**Desde PayPal:**

1. Ve a [paypal.com/activity](https://paypal.com/activity)
2. Busca la transacción
3. Haz clic en **"Issue refund"**

> **Nota:** Los reembolsos tardan 5-10 días hábiles en procesarse.

---

### 7. Ejecutar Migraciones de Base de Datos

#### Ver Migraciones Disponibles

```bash
cd backend/supabase_migrations
ls
```

Migraciones existentes:
- `001_create_courses.sql` - Tabla de cursos
- `002_create_portfolios.sql` - Tabla de portafolios
- `003_create_mentorships.sql` - Tabla de mentorías
- `004_create_transactions.sql` - Tabla de transacciones
- `005_create_admin_user.sql` - Usuario admin inicial
- `006_create_lessons_table.sql` - Tabla de lecciones
- `007_create_mentorship_sessions.sql` - Sesiones de mentoría
- `016_create_blog_posts.sql` - Blog posts

#### Ejecutar una Migración

**Método 1: Script Python (Recomendado)**

```bash
cd backend
python apply_blog_migration.py
```

**Método 2: SQL Manual en Supabase**

1. Ve a [app.supabase.com](https://app.supabase.com)
2. Selecciona tu proyecto
3. Ve a **SQL Editor**
4. Copia el contenido de la migración
5. Pega en el editor
6. Haz clic en **"Run"**

**Método 3: Supabase CLI**

```bash
supabase db push
```

#### Verificar Migración Exitosa

```sql
-- Verificar que la tabla existe
SELECT * FROM blog_posts LIMIT 1;

-- Ver estructura de la tabla
\d blog_posts
```

---

### 8. Configuración de Variables de Entorno

#### Backend (.env.production)

```env
# Base de Datos
DATABASE_URL=postgresql://usuario:password@host:5432/database
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# JWT
JWT_SECRET=tu-secret-super-seguro-de-al-menos-32-caracteres
JWT_REFRESH_SECRET=otro-secret-diferente-para-refresh-tokens

# Stripe
STRIPE_SECRET_KEY=sk_live_xxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxx

# PayPal
PAYPAL_CLIENT_ID=xxxxx
PAYPAL_CLIENT_SECRET=xxxxx
PAYPAL_MODE=live

# Email (Gmail SMTP)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=tu-email@gmail.com
SMTP_PASS=xxxx-xxxx-xxxx-xxxx  # App Password de Google

# Otros
NODE_ENV=production
PORT=5000
FRONTEND_URL=https://pqtraders.com
```

#### Frontend (.env.production.local)

```env
NEXT_PUBLIC_API_URL=https://api.pqtraders.com
NEXT_PUBLIC_STRIPE_PUBLIC_KEY=pk_live_xxxxx
NEXT_PUBLIC_PAYPAL_CLIENT_ID=xxxxx
NEXT_PUBLIC_SITE_URL=https://pqtraders.com
```

#### Configurar en Railway (Backend)

1. Ve a [railway.app](https://railway.app)
2. Selecciona tu proyecto
3. Ve a **Variables** → **Raw Editor**
4. Pega todas las variables de entorno
5. Haz clic en **"Save"**
6. El servicio se reiniciará automáticamente

#### Configurar en Vercel (Frontend)

1. Ve a [vercel.com](https://vercel.com)
2. Selecciona tu proyecto
3. Ve a **Settings** → **Environment Variables**
4. Agrega cada variable una por una
5. Redeploy el proyecto

---

## Solución de Problemas

### Error: "No se puede iniciar sesión"

**Causas posibles:**
- Contraseña incorrecta
- Usuario no existe
- Email no verificado

**Solución:**
1. Verifica que el email sea correcto
2. Usa "Recuperar contraseña" si la olvidaste
3. Revisa la carpeta de Spam para el email de confirmación

---

### Error: "Pago rechazado"

**Causas posibles:**
- Fondos insuficientes
- Tarjeta vencida
- Límite de compra excedido

**Solución:**
1. Verifica los datos de la tarjeta
2. Contacta a tu banco
3. Intenta con otro método de pago (PayPal)

---

### Error: "No puedo ver el contenido del curso"

**Causas posibles:**
- No has completado el pago
- El curso no está publicado
- Problema de sincronización

**Solución:**
1. Verifica en "Mi Dashboard" → "Historial de Pagos"
2. Cierra sesión e inicia sesión nuevamente
3. Contacta a soporte con tu ID de transacción

---

### Error: "Widget de Axtral no se muestra"

**Causas posibles:**
- Script no cargado
- CORS bloqueado
- JavaScript deshabilitado

**Solución:**
1. Abre la consola del navegador (F12)
2. Busca errores relacionados con `widget.js`
3. Verifica que JavaScript esté habilitado
4. Intenta con otro navegador

---

### Error: "No recibo emails de confirmación"

**Causas posibles:**
- Email en carpeta Spam
- Dirección incorrecta
- SMTP no configurado

**Solución:**
1. Revisa Spam/Correo no deseado
2. Verifica que el email sea correcto
3. Espera 5-10 minutos
4. Contacta a info@pqtraders.com

---

### Error 500: "Internal Server Error"

**Causas posibles:**
- Error en el backend
- Base de datos no disponible
- Variable de entorno faltante

**Solución (Admin):**
1. Revisa logs en Railway
2. Verifica variables de entorno
3. Comprueba conexión a base de datos
4. Revisa migraciones pendientes

---

### Error: "Formulario de contacto no envía"

**Causas posibles:**
- Límite de 3 mensajes/hora excedido
- SMTP no configurado
- Campos vacíos

**Solución:**
1. Espera 1 hora para reintentar
2. Completa todos los campos requeridos
3. Usa email directo: info@pqtraders.com

---

## Soporte y Contacto

### Canales de Soporte

**Email:** info@pqtraders.com  
**Horario:** Lunes a Viernes, 9:00 AM - 6:00 PM (GMT-5)  
**Tiempo de respuesta:** 24-48 horas hábiles

### Para Reportar un Bug

Envía un email con:
1. Descripción del problema
2. Pasos para reproducirlo
3. Capturas de pantalla
4. Navegador y versión
5. URL donde ocurrió

### Para Solicitar Funcionalidad

1. Describe la funcionalidad deseada
2. Explica por qué sería útil
3. Envía a: info@pqtraders.com

---

## Apéndices

### A. Códigos de Estado de Transacciones

| Código | Descripción |
|--------|-------------|
| `pending` | Pago en proceso |
| `completed` | Pago exitoso |
| `failed` | Pago rechazado |
| `refunded` | Reembolsado |
| `canceled` | Cancelado por usuario |

### B. Roles de Usuario

| Rol | Permisos |
|-----|----------|
| `student` | Acceso a cursos comprados, mentorías, blog |
| `admin` | Todos los permisos + gestión de contenido |

### C. Tipos de Lecciones

| Tipo | Descripción |
|------|-------------|
| `video` | Lección con video principal |
| `text` | Artículo o lectura |
| `quiz` | Evaluación con preguntas |
| `assignment` | Tarea o proyecto |

### D. Endpoints API Principales

**Autenticación:**
- `POST /api/auth/register` - Registro de usuario
- `POST /api/auth/login` - Inicio de sesión
- `POST /api/auth/refresh` - Renovar token

**Cursos:**
- `GET /api/courses` - Listar cursos
- `POST /api/courses` - Crear curso (admin)
- `PUT /api/courses/:id` - Actualizar curso (admin)
- `DELETE /api/courses/:id` - Eliminar curso (admin)

**Lecciones:**
- `GET /api/lessons/:courseId` - Lecciones de un curso
- `POST /api/lessons` - Crear lección (admin)
- `POST /api/lessons/:id/upload` - Subir archivo (admin)

**Blog:**
- `GET /api/blog` - Listar artículos publicados
- `GET /api/blog/slug/:slug` - Artículo por slug
- `POST /api/blog` - Crear artículo (admin)
- `PUT /api/blog/:id` - Actualizar artículo (admin)
- `DELETE /api/blog/:id` - Eliminar artículo (admin)

**Contacto:**
- `POST /api/contact` - Enviar mensaje

---

**Última actualización:** Febrero 7, 2026  
**Versión:** 1.0.0
